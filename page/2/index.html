<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="一个程序员的学习、工作日志">
  
  <title>
    
    缺陷代码
  </title>
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="缺陷代码" type="application/atom+xml">
</head>

<body>
  <main class="content">
    <section class="jumbotron">
  <div class="video">
    
    <div class="video-frame">
      <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
    </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay="" poster="/images/ocean/ocean.png"
        x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">缺陷代码</a></h1>
      <p>生活不止有眼前的苟且，还有诗和远方...</p>
      <div><img src="/images/arxmk-rz6dz.svg" class="brand" alt="缺陷代码"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>
<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>
    
    
    <article id="post-tools/sublime_text3_快捷键" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/06/23/tools/sublime_text3_%E5%BF%AB%E6%8D%B7%E9%94%AE/">sublime text3 快捷键</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/06/23/tools/sublime_text3_%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="article-date">
  <time datetime="2017-06-23T01:47:57.000Z" itemprop="datePublished">2017-06-23</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>#sublime text3 快捷键</p>
<p>Sublime Text 是一款流行的文本编辑器软件，有点类似于TextMate，跨平台，可运行在Linux，Windows和Mac OS X。也是许多程序员喜欢使用的一款文本编辑器软件。本文将简单介绍 Sublime Text 3 的快捷键操作。</p>
<table>
<thead>
<tr>
<th align="center">快捷键分类</th>
<th align="left">功能说明</th>
<th align="left">mac</th>
<th align="left">win</th>
<th align="left">Linux</th>
</tr>
</thead>
<tbody><tr>
<td align="center">界面控制</td>
<td align="left">标签控制,前后标签切换</td>
<td align="left">cmd+alt+左右箭头</td>
<td align="left">NA</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">搜索类</td>
<td align="left">在打开的文件中搜索关键字</td>
<td align="left">cmd+p</td>
<td align="left">ctrl+p</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">搜索类</td>
<td align="left">一行接一行选择光标处相同的词，后续可以统一修改</td>
<td align="left">cmd+d</td>
<td align="left">ctrl+d</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">搜索类</td>
<td align="left">一次性选中与光标处相同的全部词，统一修改</td>
<td align="left">cmd+ctrl+g</td>
<td align="left">alt+F3</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">搜索类</td>
<td align="left">跳转到对应括号</td>
<td align="left">Ctrl+M</td>
<td align="left">Ctrl+M</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">按行选择</td>
<td align="left">cmd+l</td>
<td align="left">ctrl+l</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">选择光标出的词，或空格，同时标记上下文相同内容</td>
<td align="left">cmd+l</td>
<td align="left">ctrl+l</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">删除(剪切)当前行</td>
<td align="left">cmd+x</td>
<td align="left">Ctrl+X</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">删除当前行光标之后的字符</td>
<td align="left">cmd+K+K</td>
<td align="left">Ctrl+K+K</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">在当前行之前插入新行</td>
<td align="left">cmd+Shift+Enter</td>
<td align="left">Ctrl+Shift+Enter</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">在当前行之后插入新行</td>
<td align="left">cmd+Enter</td>
<td align="left">Ctrl+Enter</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">复制当前行并在插入</td>
<td align="left">cmd+shift+D</td>
<td align="left">ctrl+shift+D</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">上下移动行光标所在行</td>
<td align="left">cmd+ctrl+上下</td>
<td align="left">ctrl+shift+上下</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">* 多个光标（选择）</td>
<td align="left">cmd+alt+鼠标左键（拖动）</td>
<td align="left">NA</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">* 多个光标</td>
<td align="left">cmd + 需要放光标的位置鼠标左键</td>
<td align="left">ctrl+ 需要放光标的位置鼠标左键</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">光标定位：</td>
<td align="left">cmd+方向键 可定位光标到页面开始、结束，行开始、结束</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">快速跳转到某一行</td>
<td align="left">ctrl＋G</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">多行缩紧</td>
<td align="left">cmd＋] &amp; cmd+[</td>
<td align="left">ctrl＋] &amp; ctrl+[</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">转换为大写</td>
<td align="left">Cmd + K + U</td>
<td align="left">ctrl＋K + U</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">编辑</td>
<td align="left">转换为小写</td>
<td align="left">Cmd + K + L</td>
<td align="left">ctrl＋K + L</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>注：标＊的非常常用，尤其是在批量编辑和插入时。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/06/23/tools/sublime_text3_%E5%BF%AB%E6%8D%B7%E9%94%AE/" data-id="clq6bcvnl001c2guz00o2ep39" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-devlang/关于hibernate_could_not_resolve_property_provinceid_of_错误" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/05/27/devlang/%E5%85%B3%E4%BA%8Ehibernate_could_not_resolve_property_provinceid_of_%E9%94%99%E8%AF%AF/">关于hibernate could not resolve property_ provinceId of 错误</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/05/27/devlang/%E5%85%B3%E4%BA%8Ehibernate_could_not_resolve_property_provinceid_of_%E9%94%99%E8%AF%AF/" class="article-date">
  <time datetime="2017-05-27T02:47:57.000Z" itemprop="datePublished">2017-05-27</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="关于hibernate-could-not-resolve-property-：-provinceId-of-错误"><a href="#关于hibernate-could-not-resolve-property-：-provinceId-of-错误" class="headerlink" title="关于hibernate could not resolve property ： provinceId of 错误"></a>关于hibernate could not resolve property ： provinceId of 错误</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.hibernate.QueryException: could not resolve property: provinceId of: com.petewell.assess.hb.model.HBExameResult</span><br></pre></td></tr></table></figure>
<p>这个错误是说，在ExameResult 中没有找到proviceId属性，通常情况下我们在ExameResult中添加相应的属性就可以了。<br>但此次报的错误没有你想象的那么简单，首先我的provinceId属性已经在BaseExameResult中定义。定义的关系如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//////////////////////</span><br><span class="line">//  BaseExameResult //     -----&gt; BaseExameResult.hbm.xml</span><br><span class="line">//////////////////////</span><br><span class="line">			∆</span><br><span class="line">			|			</span><br><span class="line">//////////////////////</span><br><span class="line">//    HBExameResult   //     -----&gt; ExameResult.hbm.xml</span><br><span class="line">//////////////////////</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在上面的这种情况下，hibernate查找映射关系时，会直接查找子类而不会找父类。那么我们这样实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">							////////////////////////////</span><br><span class="line">							//  BaseExameResult       //     -----&gt; BaseExameResult.hbm.xml</span><br><span class="line">							////////////////////////////</span><br><span class="line">								∆                   ∆               </span><br><span class="line">								|  	                |</span><br><span class="line">						///////////////////     ///////////////////////</span><br><span class="line">HBExameResult.hbm.xml&lt;-// HBExameResult //     ///  CMExameResult   //--&gt; CMExameResult.hbm.xml</span><br><span class="line">						///////////////////     //////////////////////</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/05/27/devlang/%E5%85%B3%E4%BA%8Ehibernate_could_not_resolve_property_provinceid_of_%E9%94%99%E8%AF%AF/" data-id="clq6bcvng000x2guz760eh03x" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hibernate-ORM/" rel="tag">hibernate ORM</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-devlang/quartz_cronexpression表达式" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/05/17/devlang/quartz_cronexpression%E8%A1%A8%E8%BE%BE%E5%BC%8F/">quartz CronExpression表达式</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/05/17/devlang/quartz_cronexpression%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="article-date">
  <time datetime="2017-05-17T01:47:57.000Z" itemprop="datePublished">2017-05-17</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>##quartz CronExpression表达式</p>
<p>一个cron表达式有至少6个（也可能7个）有空格分隔的时间元素。按顺序依次为1.秒（0<del>59）2.分钟（0</del>59）3.小时（0<del>23）4.天（月）（0</del>31，但是你需要考虑你月的天数）5.月（0<del>11）6.天（星期）（1</del>7 1=SUN 或 SUN，MON，TUE，WED，THU，FRI，SAT）7.年份（1970－2099）</p>
<p>其中每个元素可以是一个值(如6),一个连续区间(9-12),一个间隔时间(8-18/4)(/表示每隔4小时),一个列表(1,3,5),通配符。由于”月份中的日期”和”星期中的日期”这两个元素互斥的,必须要对其中一个设置?.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 10,14,16 * * ? 每天上午10点，下午2点，4点</span><br><span class="line">0 0/30 9-17 * * ??? 朝九晚五工作时间内每半小时</span><br><span class="line">0 0 12 ? * WED 表示每个星期三中午12点</span><br></pre></td></tr></table></figure>
<ul>
<li><p>有些子表达式能包含一些范围或列表例如：子表达式（天（星期））可以为 “MON-FRI”，“MON，WED，FRI”，“MON-WED,SAT”</p>
</li>
<li><p>“<em>”字符代表所有可能的值因此，“</em>”在子表达式（月）里表示每个月的含义，“*”在子表达式（天（星期））表示星期的每一天</p>
</li>
<li><p>“/”字符用来指定数值的增量例如：在子表达式（分钟）里的“0/15”表示从第0分钟开始，每15分钟 ;在子表达式（分钟）里的“3/20”表示从第3分钟开始，每20分钟（它和“3，23，43”）的含义一样“？”字符仅被用于天（月）和天（星期）两个子表达式，表示不指定值当2个子表达式其中之一被指定了值以后，为了避免冲突，需要将另一个子表达式的值设为“？”</p>
</li>
<li><p>“L” 字符仅被用于天（月）和天（星期）两个子表达式，它是单词“last”的缩写。但是它在两个子表达式里的含义是不同的。<br>在天（月）子表达式中，“L”表示一个月的最后一天 ,在天（星期）自表达式中，“L”表示一个星期的最后一天，也就是SAT. 如果在“L”前有具体的内容，它就具有其他的含义了</p>
<p>  例如：“6L”表示这个月的倒数第６天，“ＦＲＩＬ”表示这个月的最后一个星期五</p>
</li>
</ul>
<p>注意：在使用“L”参数时，不要指定列表或范围，因为这会导致问题</p>
<p>============================================</p>
<p>CronTrigger配置完整格式为： [秒] [分] [小时] [日] [月] [周] [年]</p>
<table>
<thead>
<tr>
<th>序号</th>
<th align="center">说明</th>
<th>是否必填</th>
<th>允许填写的值</th>
<th>允许的通配符</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td align="center">秒</td>
<td>是</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>2</td>
<td align="center">分</td>
<td>是</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>3</td>
<td align="center">小时</td>
<td>是</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>4</td>
<td align="center">日</td>
<td>是</td>
<td>1-31</td>
<td>, - * ? / L W</td>
</tr>
<tr>
<td>5</td>
<td align="center">月</td>
<td>是</td>
<td>1-12 or JAN-DEC</td>
<td>, - * /</td>
</tr>
<tr>
<td>6</td>
<td align="center">周</td>
<td>是</td>
<td>1-7 or SUN-SAT</td>
<td>, - * ? / L #</td>
</tr>
<tr>
<td>7</td>
<td align="center">年</td>
<td>否</td>
<td>empty 或 1970-2099</td>
<td>, - * /</td>
</tr>
</tbody></table>
<h4 id="通配符说明"><a href="#通配符说明" class="headerlink" title="通配符说明:"></a>通配符说明:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*表示所有值. 例如:在分的字段上设置 &quot;*&quot;,表示每一分钟都会触发。</span><br><span class="line">? 表示不指定值。使用的场景为不需要关心当前设置这个字段的值。例如:要在每月的10号触发一个操作，但不关心是周几，所以需要周位置的那个字段设置为&quot;?&quot; 具体设置为 0 0 0 10 * ?</span><br><span class="line">- 表示区间。例如 在小时上设置 &quot;10-12&quot;,表示 10,11,12点都会触发。</span><br><span class="line">, 表示指定多个值，例如在周字段上设置 &quot;MON,WED,FRI&quot; 表示周一，周三和周五触发</span><br><span class="line">/ 用于递增触发。如在秒上面设置&quot;5/15&quot; 表示从5秒开始，每增15秒触发(5,20,35,50)。 在月字段上设置&#x27;1/3&#x27;所示每月1号开始，每隔三天触发一次。</span><br><span class="line">L 表示最后的意思。在日字段设置上，表示当月的最后一天(依据当前月份，如果是二月还会依据是否是润年[leap]), 在周字段上表示星期六，相当于&quot;7&quot;或&quot;SAT&quot;。如果在&quot;L&quot;前加上数字，则表示该数据的最后一个。例如在周字段上设置&quot;6L&quot;这样的格式,则表示“本月最后一个星期五&quot; </span><br><span class="line">W 表示离指定日期的最近那个工作日(周一至周五). 例如在日字段上设置&quot;15W&quot;，表示离每月15号最近的那个工作日触发。如果15号正好是周六，则找最近的周五(14号)触发, 如果15号是周未，则找最近的下周一(16号)触发.如果15号正好在工作日(周一至周五)，则就在该天触发。如果指定格式为 &quot;1W&quot;,它则表示每月1号往后最近的工作日触发。如果1号正是周六，则将在3号下周一触发。(注，&quot;W&quot;前只能设置具体的数字,不允许区间&quot;-&quot;).</span><br><span class="line"># 序号(表示每月的第几个周几)，例如在周字段上设置&quot;6#3&quot;表示在每月的第三个周六.注意如果指定&quot;#5&quot;,正好第五周没有周六，则不会触发该配置(用在母亲节和父亲节再合适不过了) ；小提示：&#x27;L&#x27;和 &#x27;W&#x27;可以一组合使用。如果在日字段上设置&quot;LW&quot;,则表示在本月的最后一个工作日触发；周字段的设置，若使用英文字母是不区分大小写的，即MON与mon相同；</span><br></pre></td></tr></table></figure>
<h4 id="常用示例"><a href="#常用示例" class="headerlink" title="常用示例:"></a>常用示例:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0 12 * * ?    	每天12点触发    </span><br><span class="line">15 10 ? * *    	每天10点15分触发    </span><br><span class="line">15 10 * * ?    	每天10点15分触发    </span><br><span class="line">15 10 * * ? *    每天10点15分触发    </span><br><span class="line">15 10 * * ? 2005    2005年每天10点15分触发    </span><br><span class="line">* 14 * * ?    	每天下午的 2点到2点59分每分触发    </span><br><span class="line">0/5 14 * * ?    每天下午的 2点到2点59分(整点开始，每隔5分触发)    </span><br><span class="line">0/5 14,18 * * ?    每天下午的 2点到2点59分、18点到18点59分(整点开始，每隔5分触发)    </span><br><span class="line">0-5 14 * * ?    每天下午的 2点到2点05分每分触发    </span><br><span class="line">10,44 14 ? 3 WED    3月分每周三下午的 2点10分和2点44分触发    </span><br><span class="line">15 10 ? * MON-FRI    从周一到周五每天上午的10点15分触发    </span><br><span class="line">15 10 15 * ?    每月15号上午10点15分触发    </span><br><span class="line">15 10 L * ?    每月最后一天的10点15分触发    </span><br><span class="line">15 10 ? * 6L    每月最后一周的星期五的10点15分触发    </span><br><span class="line">15 10 ? * 6L 2002-2005    从2002年到2005年每月最后一周的星期五的10点15分触发    </span><br><span class="line">15 10 ? * 6#3    每月的第三周的星期五开始触发    </span><br><span class="line">0 12 1/5 * ?    每月的第一个中午开始每隔5天触发一次    </span><br><span class="line">11 11 11 11 ?    每年的11月11号 11点11分触发(光棍节)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/05/17/devlang/quartz_cronexpression%E8%A1%A8%E8%BE%BE%E5%BC%8F/" data-id="clq6bcvnc000l2guzf4i2fknz" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/quartz/" rel="tag">quartz</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-devlang/zookeeper 安装和配置" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/05/12/devlang/zookeeper%20%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/">zookeeper 安装和配置</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/05/12/devlang/zookeeper%20%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2017-05-12T01:47:57.000Z" itemprop="datePublished">2017-05-12</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>zookeeper 安装和配置</p>
<p>1.什么是zookeeper<br>　　引用官方的说法：“Zookeeper是一个高性能，分布式的，开源分布式应用协调服务。它提供了简单原始的功能，分布式应用可以基于它实现更高级的服务，比如同步，配置管理，集群管理，名空间。它被设计为易于编程，使用文件系统目录树作为数据模型。服务端跑在java上，提供java和C的客户端API”。</p>
<p>2.设计目标<br>Zookeeper服务自身组成一个集群(2n+1个服务允许n个失效)。Zookeeper服务有两个角色，一个是leader，负责写服务和数据同步，剩下的是follower，提供读服务，leader失效后会在follower中重新选举新的leader<br>Zookeeper逻辑图如下，<br><img src="/images/zookeeper/zkservice.jpg" alt="zookeeper service"></p>
<p>客户端可以连接到每个server，每个server的数据完全相同。<br>每个follower都和leader有连接，接受leader的数据更新操作。<br>Server记录事务日志和快照到持久存储。<br>大多数server可用，整体服务就可用</p>
<p>3.zookeeper能做什么<br>Zookeeper的主流应用场景实现思路（除去官方示例）<br>(1)配置管理<br>集中式的配置管理在应用集群中是非常常见的，一般商业公司内部都会实现一套集中的配置管理中心，应对不同的应用集群对于共享各自配置的需求，并且在配置变更时能够通知到集群中的每一个机器。</p>
<p>(2)集群管理<br>应用集群中，我们常常需要让每一个机器知道集群中（或依赖的其他某一个集群）哪些机器是活着的，并且在集群机器因为宕机，网络断链等原因能够不在人工介入的情况下迅速通知到每一个机器。</p>
<p>(3)数据发布与订阅 （我的业务用到这个特性，后面会有详细介绍）<br>应用配置集中到节点上，应用启动时主动获取，并在节点上注册一个watcher，每次配置更新都会通知到应用。</p>
<p>(4)名空间服务<br>分布式命名服务，创建一个节点后，节点的路径就是全局唯一的，可以作为全局名称使用。</p>
<p>(5)分布式通知/协调<br>不同的系统都监听同一个节点，一旦有了更新，另一个系统能够收到通知。</p>
<p>(6)分布式锁<br>Zookeeper能保证数据的强一致性，用户任何时候都可以相信集群中每个节点的数据都是相同的。一个用户创建一个节点作为锁，另一个用户检测该节点，如果存在，代表别的用户已经锁住，如果不存在，则可以创建一个节点，代表拥有一个锁。</p>
<p>zookeeper 安装<br>1、首选安装java运行环境。如果不知如何按照可以参加我的JAVA环境配置这篇文章，也可百度搜索。<br>2、下载zookeeper，目前最新的稳定版本为3.4.10；<a target="_blank" rel="noopener" href="http://zookeeper.apache.org/">zookeeper</a>官网下载<br>linux下可以使用wget命令下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##下载</span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/zookeeper-3.4.10.tar.gz</span><br><span class="line"></span><br><span class="line">##然后解压：</span><br><span class="line">tar -xzvf zookeeper-3.4.10.tar.gz</span><br></pre></td></tr></table></figure>

<p>##运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">### 1启动zookeeper</span><br><span class="line"># bin/zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /gzdata/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line"></span><br><span class="line">### 2查看状态</span><br><span class="line"># bin/zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /gzdata/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line">Mode: standalone</span><br><span class="line"></span><br><span class="line">### 3停止zookeeper</span><br><span class="line"># bin/zkServer.sh stop</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /gzdata/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br><span class="line"></span><br><span class="line">### 4 重启</span><br><span class="line"># bin/zkServer.sh restart</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /gzdata/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /gzdata/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line">Stopping zookeeper ... STOPPED</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /gzdata/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>

<h3 id="管理zookeeper存储"><a href="#管理zookeeper存储" class="headerlink" title="管理zookeeper存储"></a>管理zookeeper存储</h3><p>对于长时间运行的生产系统，必须从外部(dataDir和日志)管理ZooKeeper的存储。有关更多细节，请参阅<a target="_blank" rel="noopener" href="http://zookeeper.apache.org/doc/r3.4.10/zookeeperAdmin.html#sc_maintenance">维护部分</a>。</p>
<h4 id="连接Zookeeper"><a href="#连接Zookeeper" class="headerlink" title="连接Zookeeper"></a>连接Zookeeper</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ./zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>
<p>这样可以执行简单的文件操作。<br>连接后，你将看到类似下面的输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Connecting to 127.0.0.1:2181</span><br><span class="line">2017-05-11 20:21:23,599 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.10-39d3a4f269333c922ed3db283be479f9deacaa0f, built on 03/23/2017 10:13 GMT</span><br><span class="line">2017-05-11 20:21:23,605 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=localhost</span><br><span class="line">2017-05-11 20:21:23,605 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_91</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/local/jdk/jdk1.8.0_91/jre</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/gzdata/zookeeper/zookeeper-3.4.10/bin/../build/classes:/gzdata/zookeeper/zookeeper-3.4.10/bin/../build/lib/*.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../lib/slf4j-log4j12-1.6.1.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../lib/slf4j-api-1.6.1.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../lib/netty-3.10.5.Final.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../lib/log4j-1.2.16.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../lib/jline-0.9.94.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../zookeeper-3.4.10.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../src/java/lib/*.jar:/gzdata/zookeeper/zookeeper-3.4.10/bin/../conf:.:/usr/local/jdk/jdk1.8.0_91/lib/dt.jar:/usr/local/jdk/jdk1.8.0_91/lib/tools.jar</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class="line">2017-05-11 20:21:23,608 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux</span><br><span class="line">2017-05-11 20:21:23,609 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64</span><br><span class="line">2017-05-11 20:21:23,609 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=3.10.0-514.2.2.el7.x86_64</span><br><span class="line">2017-05-11 20:21:23,609 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root</span><br><span class="line">2017-05-11 20:21:23,609 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root</span><br><span class="line">2017-05-11 20:21:23,609 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/gzdata/zookeeper/zookeeper-3.4.10/bin</span><br><span class="line">2017-05-11 20:21:23,610 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=127.0.0.1:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@42110406</span><br><span class="line">2017-05-11 20:21:23,641 [myid:] - INFO  [main-SendThread(127.0.0.1:2181):ClientCnxn$SendThread@1032] - Opening socket connection to server 127.0.0.1/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)</span><br><span class="line">Welcome to ZooKeeper!</span><br><span class="line">JLine support is enabled</span><br><span class="line">2017-05-11 20:21:23,809 [myid:] - INFO  [main-SendThread(127.0.0.1:2181):ClientCnxn$SendThread@876] - Socket connection established to 127.0.0.1/127.0.0.1:2181, initiating session</span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTING) 0] 2017-05-11 20:21:23,998 [myid:] - INFO  [main-SendThread(127.0.0.1:2181):ClientCnxn$SendThread@1299] - Session establishment complete on server 127.0.0.1/127.0.0.1:2181, sessionid = 0x15bf77496660000, negotiated timeout = 30000</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br></pre></td></tr></table></figure>
<p>shell中输入help命令，可以获取一个命令列表，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">help</span><br><span class="line">ZooKeeper -server host:port cmd args</span><br><span class="line">        stat path [watch]</span><br><span class="line">        set path data [version]</span><br><span class="line">        ls path [watch]</span><br><span class="line">        delquota [-n|-b] path</span><br><span class="line">        ls2 path [watch]</span><br><span class="line">        setAcl path acl</span><br><span class="line">        setquota -n|-b val path</span><br><span class="line">        history</span><br><span class="line">        redo cmdno</span><br><span class="line">        printwatches on|off</span><br><span class="line">        delete path [version]</span><br><span class="line">        sync path</span><br><span class="line">        listquota path</span><br><span class="line">        rmr path</span><br><span class="line">        get path [watch]</span><br><span class="line">        create [-s] [-e] path data acl</span><br><span class="line">        addauth scheme auth</span><br><span class="line">        quit</span><br><span class="line">        getAcl path</span><br><span class="line">        close</span><br><span class="line">        connect host:port</span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1]</span><br></pre></td></tr></table></figure>
<p>在这，你可以尝试着输入一些简单的命令来体验下。首先，我们输入ls 命令，来看下结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 3] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure>
<p>接下来，我们通过 create /zk_test mydata 命令创建一个新的znode。新创建的znode将于字符串“mydata”关联起来，你应看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 4] create /zk_test mydata</span><br><span class="line">Created /zk_test</span><br></pre></td></tr></table></figure>
<p>我们用ls /命令来查看刚创建好的znode。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 5] ls /</span><br><span class="line">[zookeeper, zk_test]</span><br></pre></td></tr></table></figure>
<p>注意：上面的zk_test目录是我们刚刚创建的。</p>
<p>接下来，我们通过get命令验证数据是否与znode关联，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 6] get /zk_test</span><br><span class="line">mydata</span><br><span class="line">cZxid = 0x2</span><br><span class="line">ctime = Thu May 11 20:23:24 CST 2017</span><br><span class="line">mZxid = 0x2</span><br><span class="line">mtime = Thu May 11 20:23:24 CST 2017</span><br><span class="line">pZxid = 0x2</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure>
<p>我们通过set命令改变zk_test节点上关联的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 8] set /zk_test hello,world</span><br><span class="line">cZxid = 0x2</span><br><span class="line">ctime = Thu May 11 20:23:24 CST 2017</span><br><span class="line">mZxid = 0x3</span><br><span class="line">mtime = Thu May 11 20:55:08 CST 2017</span><br><span class="line">pZxid = 0x2</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 11</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 9] get /zk_test</span><br><span class="line">hello,world</span><br><span class="line">cZxid = 0x2</span><br><span class="line">ctime = Thu May 11 20:23:24 CST 2017</span><br><span class="line">mZxid = 0x3</span><br><span class="line">mtime = Thu May 11 20:55:08 CST 2017</span><br><span class="line">pZxid = 0x2</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 11</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure>
<p>注意：修改时一定要指明相应路径 ，如： /zk_test .我们通过get命令查看到数据确实发生了变化。</p>
<p>最后，我们来用delete删除节点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 10] delete /zk_test</span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 11] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 12]</span><br></pre></td></tr></table></figure>

<p>###<a target="_blank" rel="noopener" href="http://zookeeper.apache.org/doc/r3.4.10/zookeeperStarted.html">复制模式</a>：</p>
<p>在zookeeper默认是运行在单机模式下以满足评估、开发、测试的需要。但生产环境中，你必须运行在复制模式下，在同一应用内的一个复制组成为quorum，在复制模式中，quorum中的所有服务器都有相同配置文件的副本。</p>
<p>注意：<br>For replicated mode, a minimum of three servers are required, and it is strongly recommended that you have an odd number of servers. If you only have two servers, then you are in a situation where if one of them fails, there are not enough machines to form a majority quorum. Two servers is inherently less stable than a single server, because there are two single points of failure.</p>
<p>The required conf/zoo.cfg file for replicated mode is similar to the one used in standalone mode, but with a few differences. Here is an example:</p>
<p>tickTime=2000<br>dataDir=/var/lib/zookeeper<br>clientPort=2181<br>initLimit=5<br>syncLimit=2<br>server.1=zoo1:2888:3888<br>server.2=zoo2:2888:3888<br>server.3=zoo3:2888:3888</p>
<p>The new entry, initLimit is timeouts ZooKeeper uses to limit the length of time the ZooKeeper servers in quorum have to connect to a leader. The entry syncLimit limits how far out of date a server can be from a leader.</p>
<p>With both of these timeouts, you specify the unit of time using tickTime. In this example, the timeout for initLimit is 5 ticks at 2000 milleseconds a tick, or 10 seconds.</p>
<p>The entries of the form server.X list the servers that make up the ZooKeeper service. When the server starts up, it knows which server it is by looking for the file myid in the data directory. That file has the contains the server number, in ASCII.</p>
<p>Finally, note the two port numbers after each server name: “ 2888” and “3888”. Peers use the former port to connect to other peers. Such a connection is necessary so that peers can communicate, for example, to agree upon the order of updates. More specifically, a ZooKeeper server uses this port to connect followers to the leader. When a new leader arises, a follower opens a TCP connection to the leader using this port. Because the default leader election also uses TCP, we currently require another port for leader election. This is the second port in the server entry.</p>
<p>Note<br>If you want to test multiple servers on a single machine, specify the servername as localhost with unique quorum &amp; leader election ports (i.e. 2888:3888, 2889:3889, 2890:3890 in the example above) for each server.X in that server’s config file. Of course separate dataDirs and distinct clientPorts are also necessary (in the above replicated example, running on a single localhost, you would still have three config files).</p>
<p>Please be aware that setting up multiple servers on a single machine will not create any redundancy. If something were to happen which caused the machine to die, all of the zookeeper servers would be offline. Full redundancy requires that each server have its own machine. It must be a completely separate physical server. Multiple virtual machines on the same physical host are still vulnerable to the complete failure of that host.</p>
<p>参考：<br><a target="_blank" rel="noopener" href="http://coolxing.iteye.com/blog/1871009">http://coolxing.iteye.com/blog/1871009</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/05/12/devlang/zookeeper%20%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" data-id="clq6bcvnd000o2guz6rjp8xyd" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/" rel="tag">zookeeper</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-tools/java环境配置" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/05/12/tools/java%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">java环境配置</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/05/12/tools/java%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2017-05-12T01:47:57.000Z" itemprop="datePublished">2017-05-12</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p><a target="_blank" rel="noopener" href="http://www.linuxidc.com/Linux/2016-06/132678.htm">http://www.linuxidc.com/Linux/2016-06/132678.htm</a><br>下载：<br>下载 jdk-8u91-linux-x64.tar.gz：<br> wget –no-check-certificate –no-cookies –header “Cookie: Oraclelicense=accept-securebackup-cookie” <a target="_blank" rel="noopener" href="http://download.oracle.com/otn-pub/java/jdk/7u71-b14/jdk-7u71-linux-x64.rpm">http://download.oracle.com/otn-pub/java/jdk/7u71-b14/jdk-7u71-linux-x64.rpm</a><br> wget –no-check-certificate –no-cookies –header “Cookie: oraclelicense=accept-securebackup-cookie” <a target="_blank" rel="noopener" href="http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.tar.gz">http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.tar.gz</a><br> wget –no-check-certificate –no-cookies –header “Cookie: oraclelicense=accept-securebackup-cookie” <a target="_blank" rel="noopener" href="http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpm">http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpm</a><br> wget –no-cookies –header “Cookie: oraclelicense=accept-securebackup-cookie;” <a target="_blank" rel="noopener" href="http://download.oracle.com/otn-pub/java/jdk/7u65-b17/jdk-7u65-linux-x64.tar">http://download.oracle.com/otn-pub/java/jdk/7u65-b17/jdk-7u65-linux-x64.tar</a></p>
<h3 id="mac-os"><a href="#mac-os" class="headerlink" title="mac os"></a>mac os</h3><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p>JAVA_HOME=/usr/local/jdk/jdk1.8.0_91<br> JRE_HOME=$JAVA_HOME/jre<br> PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin<br> CLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib/dt.jar<br> export JAVA_HOME JRE_HOME PATH CLASSPATH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#vi /etc/profile</span><br><span class="line">#source /etc/profile</span><br><span class="line">#java -version</span><br><span class="line">java version &quot;1.8.0_91&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_91-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)</span><br></pre></td></tr></table></figure>


<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/05/12/tools/java%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" data-id="clq6bcvnl001b2guz2qzi3ctb" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java%E5%AE%89%E8%A3%85/" rel="tag">java安装</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-db/ORA-12518- TNS-listener could not hand off client connection" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/05/06/db/ORA-12518-%20TNS-listener%20could%20not%20hand%20off%20client%20connection/">ORA-12518, TNS:listener could not hand off client connection 解决方案</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/05/06/db/ORA-12518-%20TNS-listener%20could%20not%20hand%20off%20client%20connection/" class="article-date">
  <time datetime="2017-05-06T01:47:57.000Z" itemprop="datePublished">2017-05-06</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>##ORA-12518, TNS:listener could not hand off client connection 解决方案：</p>
<p>问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">org.apache.cxf.interceptor.Fault: Hibernate operation: Cannot open connection; uncategorized SQLException for SQL [???]; SQL state [66000]; error code [12518]; Listener refused the connection with the following error:</span><br><span class="line">ORA-12518, TNS:listener could not hand off client connection</span><br><span class="line"> ; nested exception is java.sql.SQLException: Listener refused the connection with the following error:</span><br><span class="line">ORA-12518, TNS:listener could not hand off client connection</span><br><span class="line"> </span><br><span class="line">        at org.apache.cxf.service.invoker.AbstractInvoker.createFault(AbstractInvoker.java:162)</span><br><span class="line">        at org.apache.cxf.jaxws.AbstractJAXWSMethodInvoker.createFault(AbstractJAXWSMethodInvoker.java:213)</span><br><span class="line">        at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:128)</span><br><span class="line">        at org.apache.cxf.jaxws.AbstractJAXWSMethodInvoker.invoke(AbstractJAXWSMethodInvoker.java:178)</span><br><span class="line">        at org.apache.cxf.jaxws.JAXWSMethodInvoker.invoke(JAXWSMethodInvoker.java:64)</span><br><span class="line">        at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:75)</span><br><span class="line">        at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:58)</span><br><span class="line">        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:439)</span><br><span class="line">        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:138)</span><br><span class="line">        ......</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>数据库系统环境说明：<br>IBM 3850 M2 ／ x3950 M2<br>cpu 8<br>内存 16G<br>win2003 enterprise Edition （5.2.3790 sp2）<br>oracle 11g （11.1.0.6.0）版本</p>
<p>分析问题：<br>遇到问题可以百度搜索，根据你的实际情况分析具体原因，并以最小的代价解决问题。<br>网上提到导致 ORA－12518错误的可能原因为：</p>
<p>一是session值过小，或用尽。</p>
<p>二是processes值设的过小，</p>
<p>三是需要增加参数DISPATCHERS。</p>
<p>首先获取上述中提及的参数值。</p>
<p>1）、查看session会话数：</p>
<p>select count(*) from v$session; –取得数据库目前的会话数。<br>select value from v$parameter where name = ‘sessions’; –取得会话数的上限。<br>select ＊ from v$session; –查看会话连接情况<br>查看当前process和sessions是否接近上限值。若接近，可以将其增大。</p>
<p>当前session数   140<br>会话数的上限     170</p>
<p>确认当前session数的连接情况，都有哪些连接。<br>其中101条为JDBC Thin Client   46条为plsqldev.exe连接。</p>
<p>2）、使用plsql连接到oracle，查看process进程数：</p>
<p>select count(*) from v$process; –取得数据库目前的进程数。<br>select value from v$parameter where name = ‘processes’;     –取得进程数的上限。 </p>
<p>目前的进程数：147<br>进程数的上限 :150</p>
<p>3）、采用专有连接方式<br>DISPATCHERS涉及到连接方式问题，这里默认采用专有连接方式。 关于连接方式参见 资料2</p>
<p>第二，存在问题：<br>1、session 与process 配置不合理。<br>2、非生产应用程序占用session。<br>注：在访问量不大时，150左右是问题不大的。访问量大时需要增加。</p>
<p>第三，处理方案：</p>
<p>1、关闭非生产应用占用的连接，如：plsqldev。 关闭后，测试验证问题消失。</p>
<p>2、调整process和session数。</p>
<p>  1).调整这两个参数值大小。<br>   系统进程数process和系统会话数session之间存在一个关系：<br>   process数=session数*1.1+5<br>   我们在配置时参考该规律进行设定。</p>
<p> a)  修改process值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter system set processes=1000 scope=spfile;   --将process值改为1000</span><br></pre></td></tr></table></figure>
<p> b)  修改session值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter system set sessions=1105 scope=spfile;    --将sessions值改为1105</span><br></pre></td></tr></table></figure>
<p>2). 备份pfile，重启oracle</p>
<p>  a) 修改完成后，备份pfile</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create pfile from spfile;   --从spfile（运行时配置）创建pfile（系统配置）</span><br></pre></td></tr></table></figure>
<p>c)  重启oracle</p>
<p>重启的方法有很多种，可以重启oracle服务，或者重启数据库。Windows下可以直接重启服务。</p>
<p>在修改process遇到问题 “ORA-32001: 已请求写入 SPFILE, 但是在启动时未指定 SPFILE” 参考资料3</p>
<p>参考资料：</p>
<p>1、问题处理方案<br>    <a target="_blank" rel="noopener" href="http://blog.csdn.net/estelle_belle/article/details/40621245">http://blog.csdn.net/estelle_belle/article/details/40621245</a><br>    <a target="_blank" rel="noopener" href="http://www.cnblogs.com/chinhr/archive/2011/10/11/2207528.html">http://www.cnblogs.com/chinhr/archive/2011/10/11/2207528.html</a><br>    <a target="_blank" rel="noopener" href="http://blog.csdn.net/yanyaocrystal/article/details/52105846">http://blog.csdn.net/yanyaocrystal/article/details/52105846</a></p>
<p>2、关于连接方式<br>     <a target="_blank" rel="noopener" href="http://www.2cto.com/database/201504/391158.html">http://www.2cto.com/database/201504/391158.html</a><br>     <a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_6d6e54f70100z12o.html">http://blog.sina.com.cn/s/blog_6d6e54f70100z12o.html</a><br>3、ORA-32001: 已请求写入 SPFILE, 但是在启动时未指定 SPFILE<br>    <a target="_blank" rel="noopener" href="http://blog.csdn.net/haiross/article/details/41696035">http://blog.csdn.net/haiross/article/details/41696035</a></p>
<p>4、关于spfile 与pfile<br>    <a target="_blank" rel="noopener" href="http://www.cnblogs.com/kerrycode/p/3254154.html">http://www.cnblogs.com/kerrycode/p/3254154.html</a><br>    <a target="_blank" rel="noopener" href="http://blog.csdn.net/test_me/article/details/5678316">http://blog.csdn.net/test_me/article/details/5678316</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/05/06/db/ORA-12518-%20TNS-listener%20could%20not%20hand%20off%20client%20connection/" data-id="clq6bcvn400052guzhlc204sg" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-devlang/Redis-Can’t-save-in-background-fork-Cannot-allocate-memory" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/04/28/devlang/Redis-Can%E2%80%99t-save-in-background-fork-Cannot-allocate-memory/">Redis: Can’t save in background: fork: Cannot allocate memory</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/04/28/devlang/Redis-Can%E2%80%99t-save-in-background-fork-Cannot-allocate-memory/" class="article-date">
  <time datetime="2017-04-28T04:30:40.000Z" itemprop="datePublished">2017-04-28</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>Redis: “Can’t save in background: fork: Cannot allocate memory”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis.clients.jedis.exceptions.JedisDataException: MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. </span><br><span class="line">for details about the error.</span><br><span class="line">	redis.clients.jedis.Protocol.processError(Protocol.java:127)</span><br><span class="line">	redis.clients.jedis.Protocol.process(Protocol.java:161)</span><br><span class="line">	redis.clients.jedis.Protocol.read(Protocol.java:215)</span><br><span class="line">	</span><br><span class="line">	....</span><br></pre></td></tr></table></figure>

<p>今天项目现场反馈说工单提交不了了，查看日志发现时 “Redis “MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk”的问题。这个错误信息是Redis客户端工具在保存数据时候抛出的异常信息。</p>
<p>网上查了一下，很多人都是建议“config set stop-writes-on-bgsave-error no”。这样做其实是不好的，这仅仅是让程序忽略了这个异常，使得程序能够继续往下运行，但实际上数据还是会存储到硬盘失败！：</p>
<p>百度了下 查到了<a target="_blank" rel="noopener" href="http://blog.csdn.net/whycold/article/details/21388455">有关linux下redis overcommit_memory的问题</a> ,提供了三种修改方案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">有三种方式修改内核参数方式，但要有root权限：</span><br><span class="line"></span><br><span class="line">  （1）编辑/etc/sysctl.conf ，改vm.overcommit_memory=1，然后sysctl -p 使配置文件生效</span><br><span class="line"></span><br><span class="line">  （2）sysctl vm.overcommit_memory=1</span><br><span class="line"></span><br><span class="line">  （3）echo 1 &gt; /proc/sys/vm/overcommit_memory</span><br></pre></td></tr></table></figure>


<p>修改后重启，总是提示 “Fatal error, can’t open config file”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server stop</span><br><span class="line">redis-server restart</span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 shutdown</span><br></pre></td></tr></table></figure>

<p>上面删除方法都试过了，无法停止。无奈只有重启解决之。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://pydelion.com/2013/05/27/redis-cant-save-in-background-fork-cannot-allocate-memory/">Redis: “Can’t save in background: fork: Cannot allocate memory”</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/04/28/devlang/Redis-Can%E2%80%99t-save-in-background-fork-Cannot-allocate-memory/" data-id="clq6bcvnb000i2guzghxnehrv" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-life/生活-眼保健操" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/02/14/life/%E7%94%9F%E6%B4%BB-%E7%9C%BC%E4%BF%9D%E5%81%A5%E6%93%8D/">爱眼护眼操</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/02/14/life/%E7%94%9F%E6%B4%BB-%E7%9C%BC%E4%BF%9D%E5%81%A5%E6%93%8D/" class="article-date">
  <time datetime="2017-02-14T11:37:57.000Z" itemprop="datePublished">2017-02-14</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>爱眼护眼操<br>尽管有好的眼镜可以帮助近视的我们看清物体，不过平时我们还是得多注意休息，做做眼保健操之类的，说不定就有用了呢。今天在网上偶然看到，与我之前练习的完全一样，也能预防近视，缓解眼睛疲劳哦！这个方法还能帮你恢复视力，前提是（500度以下）。天天看手机、电脑，眼睛会很受伤！为了你的眼睛，拒绝近视！赶紧好好的动起来吧！<br>转换焦点<br><img src="/images/life/541187689d4cf8fcc3b8e52b5dfb2f28.gif" alt="转换焦点"><br>视线上下左右移动<br><img src="/images/life/497a6d0ad39ea66c4dc30cd3f227cbf0.gif" alt="视线上下左右移动"><br>眯眼睛<br><img src="/images/life/03a5297a204e30e4b6b17f933cb70547.gif" alt="眯眼睛"><br>用目光画正方形<br><img src="/images/life/85a929f8683a66a1746df2696f20a002.gif" alt="用目光画正方形"><br>眨眼睛<br><img src="/images/life/ac5f5bb502e41345534633053395d84f.gif" alt="眨眼睛"><br>用目光画圆形<br><img src="/images/life/787bb5a4f91a5bf3aa85f61101d98c56.jpg" alt="用目光画圆形"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/02/14/life/%E7%94%9F%E6%B4%BB-%E7%9C%BC%E4%BF%9D%E5%81%A5%E6%93%8D/" data-id="clq6bcvnh00112guz64eh7s76" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB/" rel="tag">生活</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-devlang/02.nginx_tomcat_redis" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/01/17/devlang/02.nginx_tomcat_redis/">02.nginx+tomcat+redis实现集群环境的session共享。</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/01/17/devlang/02.nginx_tomcat_redis/" class="article-date">
  <time datetime="2017-01-17T09:47:57.000Z" itemprop="datePublished">2017-01-17</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="02-nginx-tomcat-redis实现集群环境的session共享。"><a href="#02-nginx-tomcat-redis实现集群环境的session共享。" class="headerlink" title="02.nginx+tomcat+redis实现集群环境的session共享。"></a>02.nginx+tomcat+redis实现集群环境的session共享。</h2><p>注：tomcat-redis-session-manager 仅对tomcat8.0.39以下版支持。8.5.9这个版本不支持，缺少LifecycleSupport 相关类。</p>
<h3 id="nginx-tomcat-集群配置"><a href="#nginx-tomcat-集群配置" class="headerlink" title="nginx tomcat 集群配置"></a>nginx tomcat 集群配置</h3><p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zht666/article/details/38515147">Nginx+Tomcat7+Mencached负载均衡集群部署笔记</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/chihirotan/p/5791401.html">Nginx-tomcat-redis——负载均衡以及session共享</a></p>
<p>nginx\tomcat 采用集群方式，部署在一台window机器上192.168.0.20。redis 部署在一台centos下，ip为192.168.0.21；</p>
<p>配置步骤如下：<br>1、安装nginx及单机测试，这里就不多说了，不会的同学可以百度下，很多。<br>2、安装tomcat 从官网下载tomcat7。注：在同一机器上部署需要修改端口，否则可能因端口冲突无法启动；我的端口分别设置为8080，8081，8082<br>3、nginx集群配置<br>修改nginx安装目录下的conf/nginx.conf 文件。修改部分如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">   #设定负载均衡的服务器列表，可以设置多个upstream，但mysvr名字要区分</span><br><span class="line">   upstream myClusterServer1 &#123;</span><br><span class="line">      #weigth参数表示权值，权值越高被分配到的几率越大</span><br><span class="line">      #本机上的Squid开启3128端口</span><br><span class="line">      server 127.0.0.1:8080  weight=5;</span><br><span class="line">      server 127.0.0.1:8081  weight=5;</span><br><span class="line">      server 127.0.0.1:8082  weight=5;</span><br><span class="line">   &#125;</span><br><span class="line">   server &#123;</span><br><span class="line">       ...</span><br><span class="line">       location / &#123;</span><br><span class="line">           root   html;</span><br><span class="line">           index  index.html index.htm index.jsp;</span><br><span class="line">           #请求转向mysvr 定义的服务器列表</span><br><span class="line">           proxy_pass    http://myClusterServer1;</span><br><span class="line">           proxy_redirect default;</span><br><span class="line">           #跟代理服务器连接的超时时间，必须留意这个time out时间不能超过75秒，当一台服务器当掉时，过10秒转发到另外一台服务器。</span><br><span class="line">       	proxy_connect_timeout 10;</span><br><span class="line">       &#125;</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br><span class="line">   ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、启动3个tomcat和nginx。<br>5、测试，编写一个简单jsp进行测试。放到tomcat下，然后<a target="_blank" rel="noopener" href="http://localhost/test.jsp">http://localhost/test.jsp</a>访问,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=iso-8859-1&quot;/&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;pragma&quot; content=&quot;no-cache&quot;/&gt;&lt;!-- HTTP 1.0 --&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">   &lt;h1&gt;Session&lt;/h1&gt;</span><br><span class="line">   &lt;table style=&quot;text-align: left;&quot; border=&quot;0&quot;&gt;</span><br><span class="line">     &lt;tr&gt;</span><br><span class="line">       &lt;th&gt;Session Id&lt;/th&gt;</span><br><span class="line">       &lt;td&gt;&lt;%=request.getSession().hashCode()%&gt;&lt;/td&gt;</span><br><span class="line">     &lt;/tr&gt;</span><br><span class="line">     &lt;tr&gt;</span><br><span class="line">       &lt;th&gt;Session IP&lt;/th&gt;</span><br><span class="line">       &lt;td&gt;&lt;%=request.getServerName()%&gt;&lt;/td&gt;</span><br><span class="line">     &lt;/tr&gt;</span><br><span class="line">     &lt;tr&gt;</span><br><span class="line">       &lt;th&gt;Session port&lt;/th&gt;</span><br><span class="line">       &lt;td&gt;&lt;%=request.getServerPort()%&gt;&lt;/td&gt;</span><br><span class="line">     &lt;/tr&gt;</span><br><span class="line">     &lt;tr&gt;</span><br><span class="line">       &lt;th&gt;server&lt;/th&gt;</span><br><span class="line">       &lt;td&gt;this is Tomcat Server 8080&lt;/td&gt;</span><br><span class="line">     &lt;/tr&gt;</span><br><span class="line">   &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="redis实现session共享"><a href="#redis实现session共享" class="headerlink" title="redis实现session共享"></a>redis实现session共享</h3><p>参考：<a target="_blank" rel="noopener" href="http://blog.csdn.net/chszs/article/details/42610365">用Redis存储Tomcat集群的Session</a></p>
<p>redis安装这里就不多说了。参见我的<a href="">redis3.2.6_安装及分布配置</a></p>
<p>1、准备tomcat-redis-session-manager包</p>
<p>注：tomcat-redis-session-manager仅支持tomcat8.0.39以下版本，并按网上提供的方法修改时没有问题的。对8.5以上版本依然没用。</p>
<p>你要到<a target="_blank" rel="noopener" href="https://github.com/jcoleman/tomcat-redis-session-manager">tomcat-redis-session-manager</a>下载源码编译。</p>
<p>在配置gradle时会遇到“No such property: sonatypeUsername错误”</p>
<p>解决方法：<br>在项目根目录下创建gradle.properties文件，文件中添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sonatypeUsername=</span><br><span class="line">sonatypePassword=</span><br><span class="line">sonatypeRepo=</span><br></pre></td></tr></table></figure>
<p>编译成功后将commons-pool2-2.4.2.jar、jedis-2.9.0.jar、tomcat-redis-session-manager-2.0.0.jar 放到tomcat的lib目录下。</p>
<p>2、在tomcat context.xml 文件中增加先内容。</p>
<p>单机redis缓存（master -slave模式）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--单点配置--&gt;</span><br><span class="line">&lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&gt;</span><br><span class="line">&lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span><br><span class="line">         host=&quot;192.168.100.194&quot;</span><br><span class="line">         port=&quot;6379&quot;</span><br><span class="line">         database=&quot;0&quot;</span><br><span class="line">         maxInactiveInterval=&quot;60&quot;</span><br><span class="line">         /&gt;</span><br></pre></td></tr></table></figure>

<p>Sentinel 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!-- Sentinel 配置 --&gt;</span><br><span class="line"> &lt;Valve className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot; /&gt;</span><br><span class="line"> &lt;Manager className=&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span><br><span class="line">   maxInactiveInterval=&quot;60&quot;</span><br><span class="line">sentinelMaster=&quot;mymaster&quot;</span><br><span class="line">   sentinels=&quot;192.168.0.194:26379,192.168.0.194:36379,192.168.0.194:46379&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>3、编写测试jsp。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;%=session.getId()%&gt;&lt;br&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        String msg = (String) session.getAttribute(&quot;msg&quot;);</span><br><span class="line">        if (null == msg) &#123;</span><br><span class="line">            session.setAttribute(&quot;msg&quot;, &quot;Hello!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            session.setAttribute(&quot;msg&quot;, msg + 0);</span><br><span class="line">        &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;%=session.getAttribute(&quot;msg&quot;)%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>分别部署到tomcat下</p>
<p>4、启动nginx和tomcat</p>
<p>分别启动tomcat和nginx后，然后访问<a target="_blank" rel="noopener" href="http://localhost/test.jsp">http://localhost/test.jsp</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B1ACBA61EEB15371A3896FCEA5FAF69D</span><br><span class="line">Hello!0000</span><br></pre></td></tr></table></figure>

<p>若出现DENIED Redis is running in protected mode because protected mode is enabled问题<br>具体提示如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis.clients.jedis.exceptions.JedisDataException: DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions:</span><br><span class="line">1) Just disable protected mode sending the command &#x27;CONFIG SET protected-mode no&#x27; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent.</span><br><span class="line">2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#x27;no&#x27;, and then restarting the server.</span><br><span class="line">3) If you started the server manually just for testing, restart it with the &#x27;--protected-mode no&#x27; option.</span><br><span class="line">4) Setup a bind address or an authentication password. NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</span><br></pre></td></tr></table></figure>
<p>你可以根据你的实际情况做出处理。<br>我这里是临时测试，在启动时把protected-mode 设置为no</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># redis-server ./redis.conf --protected-mode no</span><br></pre></td></tr></table></figure>

<p>如果生产环境建议绑定一个地址或通过密码访问。</p>
<p>单机方式下上面的方式很容易解决。但集群方式存在一个很大的坑， one client（nginx+tomcat 集群） + one server（redis+sentinel集群）下。无论是关闭protected-mode 还是 bind address 和auth pass 都无效。</p>
<p>redis集群方式配置失败！！！！</p>
<p>参考：<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/interdrp/p/4868740.html">redis + Tomcat 8 的session共享解决</a></p>
<p>分布式集群Session共享 简单多tomcat8+redis的session共享实现<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/jerome_s/article/details/52658946">http://blog.csdn.net/jerome_s/article/details/52658946</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/chszs/article/details/42610365">用Redis存储Tomcat集群的Session</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/LiZhiW/p/4851631.html#_label2">02.Redis主从集群的Sentinel配置</a><br><a target="_blank" rel="noopener" href="http://debugo.com/redis-sentinel/?utm_source=tuicool&utm_medium=referral">Redis Sentinel配置小记</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/LiZhiW/p/4851640.html">sentinel.conf配置详解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/01/17/devlang/02.nginx_tomcat_redis/" data-id="clq6bcvn8000b2guz60anhoqe" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
    <article id="post-devlang/01.redis3.2.6_安装及分布式配置" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2017/01/17/devlang/01.redis3.2.6_%E5%AE%89%E8%A3%85%E5%8F%8A%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE/">01. Redis3.2.6 安装及分布式配置</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2017/01/17/devlang/01.redis3.2.6_%E5%AE%89%E8%A3%85%E5%8F%8A%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2017-01-17T01:47:57.000Z" itemprop="datePublished">2017-01-17</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="01-Redis3-2-6-安装及分布式配置"><a href="#01-Redis3-2-6-安装及分布式配置" class="headerlink" title="01.Redis3.2.6 安装及分布式配置"></a>01.Redis3.2.6 安装及分布式配置</h2><p>参考<a target="_blank" rel="noopener" href="http://blog.csdn.net/miyatang/article/details/47257209">redis3.0.3 安装与配置</a></p>
<h3 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h3><p>####1.1 mac 上安装redis</p>
<p>1）官网 <a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a> 下载最新的稳定版本，我下的是3.2.6</p>
<p>2）sudo tar -zxf redis-3.2.6.zip 解压文件</p>
<p>3）进入解压后的目录 cd redis－3.2.6</p>
<p>4)、sudo make test 测试编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  21 seconds - integration/convert-zipmap-hash-on-load</span><br><span class="line">  85 seconds - unit/dump</span><br><span class="line">  8 seconds - unit/limits</span><br><span class="line">  14 seconds - unit/introspection-2</span><br><span class="line">  78 seconds - integration/replication-2</span><br><span class="line">  93 seconds - unit/sort</span><br><span class="line">  14 seconds - unit/bitfield</span><br><span class="line">  100 seconds - unit/type/list-3</span><br><span class="line">  41 seconds - unit/maxmemory</span><br><span class="line">  43 seconds - unit/bitops</span><br><span class="line">  56 seconds - unit/scripting</span><br><span class="line">  128 seconds - unit/type/list-2</span><br><span class="line">  43 seconds - unit/memefficiency</span><br><span class="line">  135 seconds - integration/replication</span><br><span class="line">  79 seconds - unit/obuf-limits</span><br><span class="line">  148 seconds - integration/replication-3</span><br><span class="line">  75 seconds - unit/hyperloglog</span><br><span class="line">  162 seconds - integration/replication-4</span><br><span class="line">  104 seconds - unit/geo</span><br><span class="line">  182 seconds - integration/replication-psync</span><br><span class="line"></span><br><span class="line">\o/ All tests passed without errors!</span><br><span class="line"></span><br><span class="line">Cleanup: may take some time... OK</span><br></pre></td></tr></table></figure>


<p>5)、sudo make install</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">localhost:redis-3.2.6 xingzhe$ sudo make install</span><br><span class="line">Password:</span><br><span class="line">cd src &amp;&amp; /Applications/Xcode.app/Contents/Developer/usr/bin/make install</span><br><span class="line"></span><br><span class="line">Hint: It&#x27;s a good idea to run &#x27;make test&#x27; ;)</span><br><span class="line"></span><br><span class="line">    INSTALL install</span><br><span class="line">    INSTALL install</span><br><span class="line">    INSTALL install</span><br><span class="line">    INSTALL install</span><br><span class="line">    INSTALL install</span><br></pre></td></tr></table></figure>

<p>至此，你已成功安装redis！</p>
<p>####1.2 centos7 上安装redis</p>
<p>1)、安装前，升级系统<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure><br>2)、官网下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.2.6.tar.gz</span><br></pre></td></tr></table></figure>
<p>3)、解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf redis-3.2.6.tar.gz redis-3.2.6</span><br></pre></td></tr></table></figure>
<p>4)、进入解压后的目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd redis-3.2.6</span><br></pre></td></tr></table></figure>
<p>5)、运行runtest</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ./runtest</span><br><span class="line"> You need tcl 8.5 or newer in order to run the Redis test</span><br></pre></td></tr></table></figure>
<p>如果提示 需要安装tcl，执行6步，否则跳过。<br>6)、安装tcl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install tcl</span><br></pre></td></tr></table></figure>

<p>7)、编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># make</span><br><span class="line">cd src &amp;&amp; make all</span><br><span class="line">make[1]: 进入目录“/tdata/redis-3.2.6/src”</span><br><span class="line">rm -rf redis-server redis-sentinel redis-cli redis-benchmark redis-check-rdb redis-check-aof *.o *.gcda *.gcno *.gcov redis.info lcov-html</span><br><span class="line">(cd ../deps &amp;&amp; make distclean)</span><br><span class="line">make[2]: 进入目录“/tdata/redis-3.2.6/deps”</span><br><span class="line">(cd hiredis &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd linenoise &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd lua &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd geohash-int &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd jemalloc &amp;&amp; [ -f Makefile ] &amp;&amp; make distclean) &gt; /dev/null || true</span><br><span class="line">(rm -f .make-*)</span><br><span class="line">make[2]: 离开目录“/tdata/redis-3.2.6/deps”</span><br><span class="line">(rm -f .make-*)</span><br><span class="line">echo STD=-std=c99 -pedantic -DREDIS_STATIC=&#x27;&#x27; &gt;&gt; .make-settings</span><br><span class="line">echo WARN=-Wall -W &gt;&gt; .make-settings</span><br><span class="line">echo OPT=-O2 &gt;&gt; .make-settings</span><br><span class="line">echo MALLOC=jemalloc &gt;&gt; .make-settings</span><br><span class="line">echo CFLAGS= &gt;&gt; .make-settings</span><br><span class="line">echo LDFLAGS= &gt;&gt; .make-settings</span><br><span class="line">echo REDIS_CFLAGS= &gt;&gt; .make-settings</span><br><span class="line">echo REDIS_LDFLAGS= &gt;&gt; .make-settings</span><br><span class="line">echo PREV_FINAL_CFLAGS=-std=c99 -pedantic -DREDIS_STATIC=&#x27;&#x27; -Wall -W -O2 -g -ggdb   -I../deps/geohash-int -I../deps/hiredis -I../deps/linenoise -I../deps/lua/src -DUSE_JEMALLOC -I../deps/jemalloc/include &gt;&gt; .make-settings</span><br><span class="line">echo PREV_FINAL_LDFLAGS=  -g -ggdb -rdynamic &gt;&gt; .make-settings</span><br><span class="line">(cd ../deps &amp;&amp; make hiredis linenoise lua geohash-int jemalloc)</span><br><span class="line">make[2]: 进入目录“/tdata/redis-3.2.6/deps”</span><br><span class="line">(cd hiredis &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd linenoise &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd lua &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd geohash-int &amp;&amp; make clean) &gt; /dev/null || true</span><br><span class="line">(cd jemalloc &amp;&amp; [ -f Makefile ] &amp;&amp; make distclean) &gt; /dev/null || true</span><br><span class="line">(rm -f .make-*)</span><br><span class="line">(echo &quot;&quot; &gt; .make-cflags)</span><br><span class="line">(echo &quot;&quot; &gt; .make-ldflags)</span><br><span class="line">MAKE hiredis</span><br><span class="line">cd hiredis &amp;&amp; make static</span><br><span class="line">make[3]: 进入目录“/tdata/redis-3.2.6/deps/hiredis”</span><br><span class="line">gcc -std=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb  net.c</span><br><span class="line">make[3]: gcc：命令未找到</span><br><span class="line">make[3]: *** [net.o] 错误 127</span><br><span class="line">make[3]: 离开目录“/tdata/redis-3.2.6/deps/hiredis”</span><br><span class="line">make[2]: *** [hiredis] 错误 2</span><br><span class="line">make[2]: 离开目录“/tdata/redis-3.2.6/deps”</span><br><span class="line">make[1]: [persist-settings] 错误 2 (忽略)</span><br><span class="line">    CC adlist.o</span><br><span class="line">/bin/sh: cc: 未找到命令</span><br><span class="line">make[1]: *** [adlist.o] 错误 127</span><br><span class="line">make[1]: 离开目录“/tdata/redis-3.2.6/src”</span><br><span class="line">make: *** [all] 错误 2</span><br></pre></td></tr></table></figure>
<p>若出现上面错误，说明缺少编译环境，需要安装gcc。否则跳过8步。<br>如果出现如下错误,请看第9步，否则跳过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd src &amp;&amp; make all</span><br><span class="line">make[1]: 进入目录“/tdata/redis-3.2.6/src”</span><br><span class="line">    CC adlist.o</span><br><span class="line">In file included from adlist.c:34:0:</span><br><span class="line">zmalloc.h:50:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录</span><br><span class="line"> #include &lt;jemalloc/jemalloc.h&gt;</span><br><span class="line">                               ^</span><br><span class="line">编译中断。</span><br><span class="line">make[1]: *** [adlist.o] 错误 1</span><br><span class="line">make[1]: 离开目录“/tdata/redis-3.2.6/src”</span><br><span class="line">make: *** [all] 错误 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>8)、安装gcc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install gcc</span><br></pre></td></tr></table></figure>
<p>安装成功转到6步，执行make命令。<br>9)、zmalloc.h:50:31: 致命错误：jemalloc/jemalloc.h：没有那个文件或目录<br>在make 后面增加 MALLOC=libc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># make MALLOC=libc</span><br></pre></td></tr></table></figure>
<p>10)、安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># make install</span><br></pre></td></tr></table></figure>
<p>注：在编译时，出现“../deps/geohash-int/geohash.h:78:18: 附注：‘longitude’在此声明” 警告；还有一个变量未定义。不清楚是否会有影响。目前，安装后运行测试都正常。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/uglide/RedisDesktopManager/releases/download/0.8.8/redis-desktop-manager-0.8.8.384.exe">Redis Desktop Manager</a></p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>1)、启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure>
<p> <a target="_blank" rel="noopener" href="http://www.cnblogs.com/GoQC/p/5764201.html">Redis 安装 启动 连接 配置 重启</a></p>
<p>2)、测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; set foo bar</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get foo</span><br><span class="line">&quot;bar&quot;</span><br></pre></td></tr></table></figure>

<p>恭喜你，已经成功安装！</p>
<h3 id="2、分布式配置"><a href="#2、分布式配置" class="headerlink" title="2、分布式配置"></a>2、分布式配置</h3><p>参考[1]:<a target="_blank" rel="noopener" href="http://www.redis.cn/topics/cluster-tutorial.html">Redis Cluster搭建方法简介</a></p>
<p>参考[2]:<a target="_blank" rel="noopener" href="http://blog.csdn.net/weiguolong0306/article/details/51586557"> Centos7 搭建Redis3.2.0版本集群环境</a></p>
<p>准备ruby环境,后续redis-trib.rb会用到。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install ruby</span><br><span class="line"># yum install rubygems</span><br><span class="line"># gem install redis</span><br></pre></td></tr></table></figure>




<h4 id="搭建并使用Redis集群"><a href="#搭建并使用Redis集群" class="headerlink" title="搭建并使用Redis集群[]"></a>搭建并使用Redis集群[]</h4><p>1、准备redis.conf配置文件<br>redis.conf配置如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">port 7000</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p>2、创建目录后分别启动<br>创建目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir cluster-test</span><br><span class="line">cd cluster-test</span><br><span class="line">mkdir 7000 7001 7002 7003 7004 7005</span><br></pre></td></tr></table></figure>
<p>在文件夹 7000 至 7005 中， 各创建一个 redis.conf 文件,文件中的端口与文件加相同。<br>启动,因文件夹加多启动比较繁琐。可用写个简单的脚本执行,注意一定是在文件夹内执行命令。<br>vi runcluster.sh 将下面内容cp进去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd 7000/</span><br><span class="line">../redis-server ./redis.conf &amp;</span><br><span class="line">cd ../7001</span><br><span class="line">../redis-server ./redis.conf &amp;</span><br><span class="line">cd ../7002</span><br><span class="line">../redis-server ./redis.conf &amp;</span><br><span class="line">cd ../7003</span><br><span class="line">../redis-server ./redis.conf &amp;</span><br><span class="line">cd ../7004</span><br><span class="line">../redis-server ./redis.conf &amp;</span><br><span class="line">cd ../7005</span><br><span class="line">../redis-server ./redis.conf &amp;</span><br></pre></td></tr></table></figure>
<p>nohup redis-server ./redis.conf &gt; /cluster-test/log/redis-7000.log 2&gt;&amp;1 &amp;</p>
<p>chomd +X runcluster.sh //添加执行权限<br>然后,./runcluster.sh  运行。这样就全都启动了。</p>
<p>3、搭建集群<br>redis-trib 位于 Redis 源码的 src 文件夹中,你要把它cp到cluster-test目录下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</span><br></pre></td></tr></table></figure>
<p>注意:在执行时会出现”All nodes agree about slots configuration”提示,不能直接回车,一定输入yes再回车。<br>当出现下面的说明配置完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">12400:S 12 Jan 14:45:21.671 * Background AOF rewrite finished successfully</span><br><span class="line">12397:M 12 Jan 14:45:22.055 # Cluster state changed: ok</span><br><span class="line">12398:M 12 Jan 14:45:22.155 # Cluster state changed: ok</span><br><span class="line">12399:M 12 Jan 14:45:22.189 # Cluster state changed: ok</span><br></pre></td></tr></table></figure>

<p>4、检验是否配置成功<br>./redis-trib.rb check :7000<br>你也可用通过客户端连接上测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -p 7000</span><br><span class="line">127.0.0.1:7000&gt; cluster nodes</span><br><span class="line">1577e1769a77367dd4a626b316f4191224f726c6 127.0.0.1:7005 slave 8da8517b0edd30f30104e091d782d40803c0723d 0 1484203764628 6 connected</span><br><span class="line">7436728328935447bccc1c1b54e6eab372b8c4e1 127.0.0.1:7000 myself,master - 0 0 1 connected 0-5460</span><br><span class="line">8da8517b0edd30f30104e091d782d40803c0723d 127.0.0.1:7002 master - 0 1484203766133 3 connected 10923-16383</span><br><span class="line">3a3e3c8407ee19f9f762c3a7496fc0d213ee452d 127.0.0.1:7001 master - 0 1484203765631 2 connected 5461-10922</span><br><span class="line">48302b26e73b33da61914a33d62865ba0e83f6cb 127.0.0.1:7003 slave 7436728328935447bccc1c1b54e6eab372b8c4e1 0 1484203764127 4 connected</span><br><span class="line">5b75f1ce4b70e3a780016d3a77daea7adde432ce 127.0.0.1:7004 slave 3a3e3c8407ee19f9f762c3a7496fc0d213ee452d 0 1484203765129 5 connected</span><br><span class="line">127.0.0.1:7000&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_sent:1169</span><br><span class="line">cluster_stats_messages_received:1169</span><br><span class="line">127.0.0.1:7000&gt; set name hello</span><br><span class="line">-&gt; Redirected to slot [5798] located at 127.0.0.1:7001</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">redis-cli -c -p 7003</span><br><span class="line">127.0.0.1:7003&gt; get name</span><br><span class="line">-&gt; Redirected to slot [5798] located at 127.0.0.1:7001</span><br><span class="line">&quot;hello&quot;</span><br></pre></td></tr></table></figure>

<p>5、 <a target="_blank" rel="noopener" href="http://blog.csdn.net/daiyudong2020/article/details/51674169">redis集群设置密码</a><br>注意事项：<br>1.如果是使用redis-trib.rb工具构建集群，集群构建完成前不要配置密码，集群构建完毕再通过config set + config rewrite命令逐个机器设置密码<br>2.如果对集群设置密码，那么requirepass和masterauth都需要设置，否则发生主从切换时，就会遇到授权问题，可以模拟并观察日志<br>3.各个节点的密码都必须一致，否则Redirected就会失败</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config set masterauth abc</span><br><span class="line">config set requirepass abc</span><br><span class="line">config rewrite</span><br></pre></td></tr></table></figure>

<p>config set masterauth “simonzhang”<br>config set requirepass “simonzhang”<br>config rewrite</p>
<p>密码方式访问：</p>
<p>redis-cli -p 7000 -a abc   //abc is password</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#客户端关闭</span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 shutdown</span><br><span class="line">redis-cli -h 127.0.0.1 -p 6380 shutdown</span><br><span class="line">#启动</span><br><span class="line">redis-server redis6379.conf &amp;</span><br><span class="line">redis-server redis6380.conf &amp;</span><br></pre></td></tr></table></figure>
<p>??? 主从切换<br><a target="_blank" rel="noopener" href="http://www.2cto.com/database/201502/377061.html"></a></p>
<h3 id="3、搭建前哨sentinel"><a href="#3、搭建前哨sentinel" class="headerlink" title="3、搭建前哨sentinel"></a>3、搭建前哨sentinel</h3><p>配置<br>redis-sentinel ./sentinel001.conf &amp;<br>redis-sentinel ./sentinel002.conf &amp;<br>redis-sentinel ./sentinel003.conf &amp;</p>
<p>注：sentinel.conf中要指定redis服务器的网络ip地址.不能为本机地址（127.0.0.1/localhost）。这是在单机部署时一定要注意的。</p>
<p>在有sentinel的集群环境中报：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions:</span><br><span class="line">1) Just disable protected mode sending the command &#x27;CONFIG SET protected-mode no&#x27; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent.</span><br><span class="line">2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#x27;no&#x27;, and then restarting the server.</span><br><span class="line">3) If you started the server manually just for testing, restart it with the &#x27;--protected-mode no&#x27; option.</span><br><span class="line">4) Setup a bind address or an authentication password.</span><br><span class="line"> NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</span><br></pre></td></tr></table></figure>

<h3 id="4、主从配置"><a href="#4、主从配置" class="headerlink" title="4、主从配置"></a>4、主从配置</h3><p>master 部署在192.168.0.99上，配置文件为redis.conf;slave部署在192.168.0.100上，从master上复制一份配置文件命名为redis-slave.conf,如果你是单机部署需要修改ip和端口号。<br>再在redis-slav.conf配置文件中增加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 192.168.0.99 6379</span><br></pre></td></tr></table></figure>

<h3 id="5、配置文件"><a href="#5、配置文件" class="headerlink" title="5、配置文件"></a>5、配置文件</h3><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/u012173245/article/details/52041882">http://blog.csdn.net/u012173245/article/details/52041882</a><br><a target="_blank" rel="noopener" href="http://yijiebuyi.com/blog/bc2b3d3e010bf87ba55267f95ab3aa71.html">http://yijiebuyi.com/blog/bc2b3d3e010bf87ba55267f95ab3aa71.html</a><br><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/antirez/redis/3.0/redis.conf">https://raw.githubusercontent.com/antirez/redis/3.0/redis.conf</a></p>
<h3 id="6、参考资料"><a href="#6、参考资料" class="headerlink" title="6、参考资料"></a>6、参考资料</h3><p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/LiZhiW/p/4851631.html#_label2">http://www.cnblogs.com/LiZhiW/p/4851631.html#_label2</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/donggang1992/article/details/50981341">http://blog.csdn.net/donggang1992/article/details/50981341</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/zyz511919766/article/details/42268219">http://blog.csdn.net/zyz511919766/article/details/42268219</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/stupidMartian/p/5904030.html">http://www.cnblogs.com/stupidMartian/p/5904030.html</a></p>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#修改为守护模式</span><br><span class="line">daemonize yes</span><br><span class="line">#设置进程锁文件</span><br><span class="line">pidfile /usr/local/redis/redis.pid</span><br><span class="line">#端口</span><br><span class="line">port 6379</span><br><span class="line">#客户端超时时间</span><br><span class="line">timeout 300</span><br><span class="line">#日志级别</span><br><span class="line">loglevel debug</span><br><span class="line">#日志文件位置</span><br><span class="line">logfile /usr/local/redis/log-redis.log</span><br><span class="line">#设置数据库的数量，默认数据库为0，可以使用SELECT &lt;dbid&gt;命令在连接上指定数据库id</span><br><span class="line">databases 8</span><br><span class="line">##指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span><br><span class="line">#save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#Redis默认配置文件中提供了三个条件：</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">#指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，</span><br><span class="line">#可以关闭该#选项，但会导致数据库文件变的巨大</span><br><span class="line">rdbcompression yes</span><br><span class="line">#指定本地数据库文件名</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">#指定本地数据库路径</span><br><span class="line">dir /usr/local/redis/db/</span><br><span class="line">#指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能</span><br><span class="line">#会在断电时导致一段时间内的数据丢失。因为 redis本身同步数据文件是按上面save条件来同步的，所以有</span><br><span class="line">#的数据会在一段时间内只存在于内存中</span><br><span class="line">appendonly no</span><br><span class="line">#指定更新日志条件，共有3个可选值：</span><br><span class="line">#no：表示等操作系统进行数据缓存同步到磁盘（快）</span><br><span class="line">#always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）</span><br><span class="line">#everysec：表示每秒同步一次（折衷，默认值）</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure>

<h3 id="6、文档"><a href="#6、文档" class="headerlink" title="6、文档"></a>6、文档</h3><ul>
<li><a target="_blank" rel="noopener" href="http://doc.redisfans.com/#">Redis 命令参考</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://groupfusion.github.io/2017/01/17/devlang/01.redis3.2.6_%E5%AE%89%E8%A3%85%E5%8F%8A%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE/" data-id="clq6bcvn9000d2guzfrexcyy5" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li></ul>

    </footer>

  </div>

  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-bar-chart"></i> <span id="busuanzi_value_site_pv"></span></li>
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>缺陷代码 &copy; 2023</li>
      
        <li></li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/xmon.svg" alt="缺陷代码"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/favorites">收藏</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>






<script src="/js/ocean.js"></script>

</body>

</html>